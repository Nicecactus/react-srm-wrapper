{"version":3,"sources":["../../store.ts","../../index.tsx","store.ts","App.tsx","index.tsx"],"names":["packg","SRMStore","createContextStore","initialData","sendEvent","navigate","basename","setBasename","action","state","value","language","setLanguage","messages","loadMessages","require","e","name","overrideModel","store","key","removeModel","addModel","path","render","srm","props","element","selector","ret","Content","memo","useStore","getActions","c","getState","React","IntlProvider","locale","defaultLocale","Object","assign","el","document","querySelector","ReactDOM","className","StrictMode","Provider","out","split","reduce","obj","part","window","ContextStore","getAccessToken","a","localStorage","getItem","App","role","aria-label","SRM"],"mappings":"yOAoBA,ICRIA,EAFSC,EDUQC,sBACnB,SAACC,UACCA,GAAe,CACbC,+CACAC,SAAU,aACVC,SAAU,IACVC,YAAaC,UAA0B,SAACC,EAAOC,GAC7CD,EAAMH,SAAWI,GAAS,OAE5BC,SAAU,KACVC,YAAaJ,UAA0B,SAACC,EAAOC,SAC7CD,EAAME,SAAWD,GAAS,KAC1BD,EAAMI,mBAAWJ,EAAMK,iCAANL,SAAqBA,EAAME,aAE9CG,aAAc,iBAAO,IACrBD,SAAU,OCtBhB,IACEb,EAAQe,EAAQ,IAChB,MAAOC,GACPhB,EAAQ,CAAEiB,KAAM,eAoClB,SAAgBC,EAIdC,EACAC,EACAV,GAEa,MAATA,IACFS,EAAME,YAAYD,GAClBD,EAAMG,SAASF,EAAYV,UAmB/B,SACEa,EACAC,EACAV,GAEA,IAAMW,EAAgF,SAACC,GACrF,IACEC,EAMED,EANFC,QACAC,EAKEF,EALFE,SACAtB,EAIEoB,EAJFpB,SACAK,EAGEe,EAHFf,SACAP,EAEEsB,EAFFtB,UACAC,EACEqB,EADFrB,SAGEwB,EAAM,GACJC,EAAUC,QAAK,WACnB,IAAMZ,EAAQlB,EAAS+B,YAEnBN,EAAMZ,cAAgBA,IACxBI,EAAcC,EAAO,eAAgBO,EAAMZ,cAAgBA,GAG7D,IAAQP,EAAgBY,EAAMc,aAAtB1B,YACJD,GACFC,EAAYD,GAGd,IAAQM,EAAgBO,EAAMc,aAAtBrB,YAENA,EADED,GAGU,MAGVP,GACFc,EAAcC,EAAO,YAAaf,GAGhCC,GACFa,EAAcC,EAAO,WAAYd,GAGnCwB,EAAM,CACJtB,cACAK,eAGF,IAAAsB,EAAuCf,EAAMgB,WAC7C,OACEC,gBAACC,gBAAaC,SAFE3B,SAEcE,WAFxBA,SAE4C0B,cAAc,MAC5Df,EAAOgB,OAAOC,OAAO,GAAIf,EAAOP,QAKlCuB,EAAKf,GAAWgB,SAASC,cAAchB,GAAY,QAYzD,OAXAiB,EAASrB,OACPY,uBAAKU,eAAgB9C,EAAMiB,MACzBmB,gBAACA,EAAMW,gBACLX,gBAACnC,EAAS+C,cACRZ,gBAACN,WAIPY,GAGKb,GAKT,OAxFF,SACEN,EACAE,GAEA,IAAMwB,EAAM1B,EAAK2B,MAAM,KAAKC,QAAO,SAACC,EAAKC,GAKvC,OAJKD,EAAIC,KACPD,EAAIC,GAAQ,IAGPD,EAAIC,KACVC,QAEHd,OAAOC,OAAOQ,GAAO,GAAI,CAAEzB,OAAQC,IAZrC,CAsFYF,EAAME,GAETA,mC,+0DCvIM8B,EAbMrD,aACnB,SAACC,GAAD,OACEA,GAAe,CACbqD,eAAe,WAAD,4BAAE,sBAAAC,EAAA,wFAELC,aAAaC,QAAQ,gBAFhB,yDAIL,MAJK,wDAAF,kDAAC,OCCNC,EARH,WACV,OACE,6CACc,0BAAMC,KAAK,MAAMC,aAAW,WAA5B,kBCYZtC,EAASuC,cACb,gBACA,YAAgC,IAA7BP,EAA4B,EAA5BA,eACK1B,EAAU,WACd,IAAMX,EAAQoC,EAAavB,WAI3B,OAFAd,wBAAcC,EAAO,iBAAkBqC,GAGrC,oCACE,kBAAC,EAAD,QAKN,OACE,kBAAC,EAAaR,SAAd,KACE,kBAAClB,EAAD,UAMON,c","file":"static/js/main.f917e845.chunk.js","sourcesContent":["import { action, Action, createContextStore } from \"easy-peasy\";\n\nexport type Messages = { [term: string]: string };\n\nexport type LoadMessagesFunction = (lang: string) => Messages;\n\nexport interface ContextStoreModel {\n  sendEvent: (id: string, ...args: Array<any>) => Promise<any>;\n  navigate: (\n    commands: string | Array<string>,\n    options?: { queryParams?: any }\n  ) => any;\n  basename: string;\n  setBasename: Action<ContextStoreModel, string | undefined>;\n  language: string;\n  setLanguage: Action<ContextStoreModel, string | undefined>;\n  loadMessages: LoadMessagesFunction;\n  messages: Messages;\n}\n\nconst ContextStore = createContextStore<ContextStoreModel>(\n  (initialData) =>\n    initialData || {\n      sendEvent: async () => {},\n      navigate: () => {},\n      basename: \"/\",\n      setBasename: action<ContextStoreModel>((state, value) => {\n        state.basename = value || \"/\";\n      }),\n      language: \"en\",\n      setLanguage: action<ContextStoreModel>((state, value) => {\n        state.language = value || \"en\";\n        state.messages = state.loadMessages?.(state.language);\n      }),\n      loadMessages: () => ({}),\n      messages: {},\n    }\n);\n\nexport default ContextStore;\n","import React, { memo, ReactElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Store } from 'easy-peasy';\nimport { IntlProvider } from 'react-intl';\nimport _SRMStore, { ContextStoreModel, LoadMessagesFunction } from './store';\n\nimport '@formatjs/intl-locale/polyfill';\nimport '@formatjs/intl-relativetimeformat/polyfill';\nimport '@formatjs/intl-relativetimeformat/locale-data/en';\n\nexport const SRMStore = _SRMStore;\n\nlet packg: { name: string };\ntry {\n  packg = require('webapp__package.json');\n} catch (e) {\n  packg = { name: 'srm_testing' };\n}\ninterface PropsMountSelector {\n  selector: string;\n  element?: null;\n}\n\ninterface PropsMountElement {\n  selector?: null;\n  element: HTMLElement;\n}\n\ntype PropsMount = PropsMountSelector | PropsMountElement;\n\ninterface PropsCommon {\n  sendEvent?: (id: string, ...args: Array<any>) => Promise<any>;\n  navigate: (\n    commands: string | Array<string>,\n    options?: { queryParams?: any }\n  ) => any;\n  loadMessages?: LoadMessagesFunction;\n  basename?: string;\n  language?: string;\n}\n\nexport type PropsSRM<T = void> = PropsMount & PropsCommon & T;\nexport type PropsApp = { [key: string]: any };\n\nexport type RenderFunction<Props extends PropsApp> = (\n  props: Props\n) => ReactElement;\n\nexport type SRMFunction<Props extends PropsApp> = (\n  props: Props\n) => any;\n\nexport function overrideModel<\n  StoreModel extends Object = {},\n  Key extends keyof StoreModel = any\n>(\n  store: Store<StoreModel, any>,\n  key: Key,\n  value: StoreModel[Key] | undefined | null\n) {\n  if (value != null) {\n    store.removeModel(key as any);\n    store.addModel(key as any, value as any);\n  }\n}\n\nfunction exportSRM<Props extends PropsApp>(\n  path: string,\n  srm: SRMFunction<Props>\n) {\n  const out = path.split('.').reduce((obj, part) => {\n    if (!obj[part]) {\n      obj[part] = {};\n    }\n\n    return obj[part];\n  }, window as any);\n\n  Object.assign(out || {}, { render: srm });\n}\n\nexport function SRM<Props extends PropsApp>(\n  path: string,\n  render: RenderFunction<Props & { store: Store<ContextStoreModel, any> }>,\n  loadMessages?: LoadMessagesFunction,\n): SRMFunction<Props & PropsSRM & { store: Store<ContextStoreModel, any> }> {\n  const srm: SRMFunction<Props & PropsSRM & { store: Store<ContextStoreModel, any> }> = (props) => {\n    const {\n      element,\n      selector,\n      basename,\n      language,\n      sendEvent,\n      navigate,\n    } = props;\n\n    let ret = {};\n    const Content = memo(() => {\n      const store = SRMStore.useStore();\n\n      if (props.loadMessages || loadMessages) {\n        overrideModel(store, 'loadMessages', props.loadMessages || loadMessages);\n      }\n\n      const { setBasename } = store.getActions();\n      if (basename) {\n        setBasename(basename);\n      }\n\n      const { setLanguage } = store.getActions();\n      if (language) {\n        setLanguage(language);\n      } else {\n        setLanguage('en');\n      }\n\n      if (sendEvent) {\n        overrideModel(store, 'sendEvent', sendEvent);\n      }\n\n      if (navigate) {\n        overrideModel(store, 'navigate', navigate);\n      }\n\n      ret = {\n        setBasename,\n        setLanguage,\n      };\n\n      const { messages, language: locale } = store.getState();\n      return (\n        <IntlProvider locale={locale} messages={messages} defaultLocale=\"en\">\n          { render(Object.assign({}, props, store)) }\n        </IntlProvider>\n      );\n    });\n\n    const el = element || document.querySelector(selector || \"#srm\");\n    ReactDOM.render(\n      <div className={`__${packg.name}`}>\n        <React.StrictMode>\n          <SRMStore.Provider>\n            <Content />\n          </SRMStore.Provider>\n        </React.StrictMode>\n      </div>,\n      el\n    );\n\n    return ret;\n  };\n\n  exportSRM(path, srm);\n\n  return srm;\n}\n","import { createContextStore } from \"easy-peasy\";\n\nexport interface ContextStoreModel {\n  getAccessToken: () => Promise<string | null>;\n}\n\nconst ContextStore = createContextStore<ContextStoreModel>(\n  (initialData) =>\n    initialData || {\n      getAccessToken: async () => {\n        try {\n          return localStorage.getItem(\"accessToken\");\n        } catch (e) {\n          return null;\n        }\n      },\n    }\n);\n\nexport default ContextStore;\n","import React from 'react'\n\nconst App = () => {\n  return (\n    <span>\n      SRM Example <span role=\"img\" aria-label=\"trophee\">üèÜ</span>\n    </span>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react';\nimport { SRM, overrideModel } from \"@robingoupil/srm\";\nimport ContextStore from './store';\nimport App from './App'\n\ndeclare global {\n  export interface Window {\n    nicecactus: { wallet: { render: typeof render } };\n  }\n}\n\nexport interface Props {\n  getAccessToken(): Promise<string>,\n}\n\nconst render = SRM(\n  \"testing.test\",\n  ({ getAccessToken }: Props) => {\n    const Content = () => {\n      const store = ContextStore.useStore();\n\n      overrideModel(store, \"getAccessToken\", getAccessToken);\n\n      return (\n        <>\n          <App />\n        </>\n      );\n    };\n\n    return (\n      <ContextStore.Provider>\n        <Content />\n      </ContextStore.Provider>\n    );\n  }\n);\n\nexport default render;\n"],"sourceRoot":""}